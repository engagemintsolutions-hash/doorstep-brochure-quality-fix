<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social Media Studio</title>
    <!-- Navigation will be added in body -->
    <!-- Navigation will be added in body -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #4A1420 0%, #3a0f18 100%);
            min-height: 100vh;
            padding: 2rem;
        }

        .studio-container {
            max-width: 1600px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 420px 1fr;
            gap: 2rem;
            height: calc(100vh - 4rem);
        }

        /* LEFT PANEL - Carousel Editor */
        .carousel-panel {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .panel-header {
            margin-bottom: 1.5rem;
        }

        .panel-header h2 {
            font-size: 1.5rem;
            color: #1e293b;
            margin-bottom: 0.5rem;
        }

        .panel-header p {
            color: #64748b;
            font-size: 0.9rem;
        }

        /* Instagram-style Carousel */
        .carousel-container {
            position: relative;
            background: #000;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 1.5rem;
            aspect-ratio: 1 / 1;
        }

        .carousel-main {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .carousel-track {
            display: flex;
            width: 100%;
            height: 100%;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .carousel-slide {
            min-width: 100%;
            height: 100%;
            position: relative;
        }


        .photo-cover-badge {
            position: absolute;
            top: 8px;
            left: 8px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 0.5px;
            z-index: 10;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .photo-cover-badge {
            position: absolute;
            top: 8px;
            left: 8px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 0.5px;
            z-index: 10;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .carousel-slide img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .carousel-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            z-index: 10;
            width: 56px;
            height: 56px;
            background: rgba(255,255,255,0.9);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            color: #1e293b;
            transition: all 0.2s;
            backdrop-filter: blur(8px);
            font-weight: 700;
        }

        .carousel-nav:hover {
            background: white;
            transform: translateY(-50%) scale(1.15);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .carousel-nav.prev { left: 12px; }
        .carousel-nav.next { right: 12px; }

        .carousel-dots {
            position: absolute;
            bottom: 12px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 6px;
            z-index: 10;
        }

        .carousel-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255,255,255,0.5);
            cursor: pointer;
            transition: all 0.3s;
        }

        .carousel-dot.active {
            background: white;
            width: 24px;
            border-radius: 4px;
        }

        /* Photo Manager */
        .photo-manager {
            margin-bottom: 1.5rem;
        }

        .photo-manager-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: #64748b;
            margin-bottom: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .photo-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        .photo-item {
            aspect-ratio: 1;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            cursor: grab;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .photo-item:active {
            cursor: grabbing;
        }

        .photo-item.selected {
            border-color: #4A1420;
            box-shadow: 0 0 0 3px rgba(23,162,184,0.2);
        }

        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-item-number {
            position: absolute;
            top: 4px;
            left: 4px;
            width: 20px;
            height: 20px;
            background: rgba(0,0,0,0.7);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .photo-item-remove {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 20px;
            height: 20px;
            background: #ef4444;
            color: white;
            border: 2px solid white;
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
            cursor: pointer;
        }

        .photo-item:hover .photo-item-remove {
            display: flex;
        }

        .add-photo-btn {
            aspect-ratio: 1;
            border: 2px dashed #cbd5e1;
            border-radius: 8px;
            background: #f8fafc;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: #94a3b8;
            transition: all 0.2s;
        }

        .add-photo-btn:hover {
            border-color: #7c3aed;
            color: #7c3aed;
            background: #f5f3ff;
        }

        /* Platform Selector */
        .platform-selector {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 1.5rem;
        }

        .platform-btn {
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            color: #64748b;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .platform-btn:hover {
            transform: translateY(-2px);
        }

        .platform-btn.active {
            transform: translateY(0);
        }

        .platform-btn.active.facebook {
            background: #1877f2;
            border-color: #1877f2;
            color: white;
        }

        .platform-btn.active.instagram {
            background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
            border: none;
            color: white;
        }

        .platform-btn.active.linkedin {
            background: #0077b5;
            border-color: #0077b5;
            color: white;
        }

        /* RIGHT PANEL - Live Preview & Editor */
        .editor-panel {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .preview-section {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .preview-header h3 {
            font-size: 1.25rem;
            color: #1e293b;
        }

        .preview-device-info {
            font-size: 0.85rem;
            color: #64748b;
            background: #f1f5f9;
            padding: 0.5rem 1rem;
            border-radius: 20px;
        }

        /* Live Preview Mockup */
        .preview-mockup {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            overflow: hidden;
            max-width: 600px;
            margin: 0 auto;
            transition: all 0.3s;
        }

        .mockup-header {
            background: white;
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            border-bottom: 1px solid #e2e8f0;
        }

        .mockup-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4A1420, #3a0f18);
        }

        .mockup-info h4 {
            font-size: 0.9rem;
            color: #1e293b;
            font-weight: 600;
        }

        .mockup-info p {
            font-size: 0.75rem;
            color: #94a3b8;
        }

        .mockup-carousel-container {
            position: relative;
            background: #000;
            transition: all 0.3s;
        }

        .mockup-carousel-container.facebook { aspect-ratio: 1.91 / 1; }
        .mockup-carousel-container.instagram { aspect-ratio: 1 / 1; }
        .mockup-carousel-container.linkedin { aspect-ratio: 1.91 / 1; }

        .mockup-carousel-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .mockup-carousel-dots {
            position: absolute;
            bottom: 12px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 4px;
        }

        .mockup-carousel-dots .dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: rgba(255,255,255,0.5);
        }

        .mockup-carousel-dots .dot.active {
            background: white;
        }

        .mockup-content {
            padding: 1rem;
            background: white;
        }

        .mockup-text {
            font-size: 0.9rem;
            line-height: 1.5;
            color: #1e293b;
            margin-bottom: 0.75rem;
            white-space: pre-wrap;
        }

        .mockup-hashtags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .mockup-hashtag {
            color: #3b82f6;
            font-size: 0.85rem;
            font-weight: 500;
        }

        /* Text Editor Section */
        .editor-section {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .variant-tabs {
            display: flex;
            gap: 0.5rem;
        }

        .variant-tab {
            padding: 0.5rem 1rem;
            border: 2px solid #e2e8f0;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            color: #64748b;
            transition: all 0.2s;
        }

        .variant-tab.active {
            background: #7c3aed;
            border-color: #7c3aed;
            color: white;
        }

        .editor-tools {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .tool-btn {
            width: 36px;
            height: 36px;
            border: 2px solid #e2e8f0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.2s;
        }

        .tool-btn:hover {
            background: #f8fafc;
            border-color: #7c3aed;
        }

        .text-editor {
            width: 100%;
            min-height: 200px;
            padding: 1.25rem;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1rem;
            line-height: 1.6;
            font-family: inherit;
            resize: vertical;
            transition: all 0.2s;
        }

        .text-editor:focus {
            outline: none;
            border-color: #7c3aed;
            box-shadow: 0 0 0 3px rgba(124,58,237,0.1);
        }

        .char-info {
            display: flex;
            justify-content: space-between;
            margin-top: 0.75rem;
            font-size: 0.85rem;
            color: #64748b;
        }

        .char-count.warning {
            color: #f59e0b;
            font-weight: 600;
        }

        .char-count.error {
            color: #ef4444;
            font-weight: 600;
        }

        /* Hashtags */
        .hashtags-section {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #e2e8f0;
        }

        .hashtags-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .hashtags-header h4 {
            font-size: 1rem;
            color: #1e293b;
        }

        .hashtag-score {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .score-badge {
            font-size: 1rem;
            font-weight: 700;
            color: #7c3aed;
        }

        .score-bar-container {
            width: 80px;
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            overflow: hidden;
        }

        .score-bar {
            height: 100%;
            background: linear-gradient(90deg, #ef4444, #f59e0b, #10b981);
            transition: width 0.3s;
        }

        .hashtags-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .hashtag {
            padding: 0.5rem 1rem;
            background: #f1f5f9;
            border: 2px solid #e2e8f0;
            border-radius: 20px;
            font-size: 0.85rem;
            color: #3b82f6;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .hashtag:hover {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .hashtag-score-badge {
            font-size: 0.7rem;
            padding: 0.15rem 0.4rem;
            border-radius: 10px;
            background: white;
            font-weight: 700;
        }

        .hashtag-score-badge.high { color: #10b981; }
        .hashtag-score-badge.medium { color: #f59e0b; }
        .hashtag-score-badge.low { color: #ef4444; }

        .optimize-btn {
            width: 100%;
            padding: 0.875rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .optimize-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(124,58,237,0.4);
        }

        /* Features Section */
        .features-section {
            background: white;
            border-radius: 12px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            border: 2px solid #e2e8f0;
            transition: all 0.2s;
        }

        .features-section:hover {
            border-color: #4A1420;
            box-shadow: 0 4px 12px rgba(23,162,184,0.1);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .section-header h4 {
            margin: 0;
            font-size: 1rem;
            color: #1e293b;
            font-weight: 600;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            transition: 0.3s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        .toggle-switch input:checked + .toggle-slider {
            background: linear-gradient(135deg, #4A1420 0%, #138496 100%);
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }

        .features-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .feature-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            background: #f8fafc;
            border-radius: 6px;
            font-size: 0.9rem;
            color: #475569;
        }

        .feature-item:before {
            content: "‚úì";
            color: #4A1420;
            font-weight: bold;
            font-size: 1rem;
        }

        /* Contact Section */
        .contact-section {
            background: white;
            border-radius: 12px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            border: 2px solid #e2e8f0;
            transition: all 0.2s;
        }

        .contact-section:hover {
            border-color: #3a0f18;
            box-shadow: 0 4px 12px rgba(255,107,107,0.1);
        }

        .contact-info {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .contact-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 0.9rem;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            transition: all 0.2s;
        }

        .contact-input:focus {
            outline: none;
            border-color: #3a0f18;
            box-shadow: 0 0 0 3px rgba(255,107,107,0.1);
        }

        .contact-input::placeholder {
            color: #94a3b8;
        }


        .save-draft-btn {
            padding: 0.75rem 1.25rem;
            background: #f59e0b;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .save-draft-btn:hover {
            background: #d97706;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(245,158,11,0.4);
        }

        .save-draft-btn {
            padding: 0.75rem 1.25rem;
            background: #f59e0b;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .save-draft-btn:hover {
            background: #d97706;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(245,158,11,0.4);
        }
        /* Action Buttons */
        .actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .action-btn {
            flex: 1;
            padding: 1rem;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .action-btn.primary {
            background: linear-gradient(135deg, #4A1420 0%, #138496 100%);
            color: white;
        }

        .action-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(23,162,184,0.4);
        }

        .action-btn.secondary {
            background: white;
            color: #1e293b;
            border: 2px solid #e2e8f0;
        }

        .action-btn.secondary:hover {
            background: #f8fafc;
        }

        /* Emoji Picker */
        .emoji-picker {
            display: none;
            position: absolute;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 1rem;
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
            z-index: 1000;
            max-width: 320px;
        }

        .emoji-picker.show {
            display: block;
        }

        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 0.5rem;
            max-height: 200px;
            overflow-y: auto;
        }

        .emoji-item {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .emoji-item:hover {
            background: #f1f5f9;
            transform: scale(1.2);
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: #1e293b;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 10px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.3);
            display: none;
            z-index: 2000;
            animation: slideUp 0.3s ease;
        }

        .toast.show {
            display: block;
        }

        @keyframes slideUp {
            from {
                transform: translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Helper text */
        .helper-text {
            margin-top: 1rem;
            padding: 0.75rem 1rem;
            background: #f8fafc;
            border-left: 3px solid #7c3aed;
            border-radius: 6px;
            font-size: 0.85rem;
            color: #64748b;
        }

        /* Schedule Button */
        .action-btn.schedule {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
        }

        .action-btn.schedule:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        /* Navigation Link */
        .nav-link {
            position: absolute;
            top: 2rem;
            right: 2rem;
            background: rgba(255, 255, 255, 0.9);
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            text-decoration: none;
            color: #667eea;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            z-index: 100;
        }

        .nav-link:hover {
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        /* Modal Overlay */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        /* Modal Content */
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 2.5rem;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f1f5f9;
        }

        .modal-header h3 {
            font-size: 1.75rem;
            color: #1e293b;
            margin: 0;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 2rem;
            color: #64748b;
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            transition: all 0.2s ease;
        }

        .close-btn:hover {
            background: #f1f5f9;
            color: #1e293b;
        }

        /* Platform Selector */
        .platform-selector {
            margin-bottom: 1.5rem;
        }

        .platform-selector label {
            display: inline-flex;
            align-items: center;
            margin-right: 1.5rem;
            cursor: pointer;
            font-weight: 500;
            color: #475569;
        }

        .platform-selector input[type="checkbox"] {
            margin-right: 0.5rem;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        /* Date Time Picker */
        .datetime-group {
            margin-bottom: 1.5rem;
        }

        .datetime-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #1e293b;
        }

        .datetime-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .datetime-inputs input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.2s ease;
        }

        .datetime-inputs input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* Schedule Options */
        .schedule-options {
            display: grid;
            gap: 1rem;
            margin-top: 2rem;
        }

        .schedule-options button {
            padding: 1rem;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .schedule-options .btn-post-now {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .schedule-options .btn-schedule {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .schedule-options .btn-draft {
            background: #f1f5f9;
            color: #64748b;
        }

        .schedule-options button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .schedule-options button:active {
            transform: translateY(0);
        }

        /* Success Message */
        .success-message {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            display: none;
        }

        .success-message.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }


        /* Schedule Button */
        .action-btn.schedule {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
        }

        .action-btn.schedule:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        /* Navigation Link */
        .nav-link {
            position: absolute;
            top: 2rem;
            right: 2rem;
            background: rgba(255, 255, 255, 0.9);
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            text-decoration: none;
            color: #667eea;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            z-index: 100;
        }

        .nav-link:hover {
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        /* Modal Overlay */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        /* Modal Content */
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 2.5rem;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f1f5f9;
        }

        .modal-header h3 {
            font-size: 1.75rem;
            color: #1e293b;
            margin: 0;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 2rem;
            color: #64748b;
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            transition: all 0.2s ease;
        }

        .close-btn:hover {
            background: #f1f5f9;
            color: #1e293b;
        }

        /* Platform Selector */
        .platform-selector {
            margin-bottom: 1.5rem;
        }

        .platform-selector label {
            display: inline-flex;
            align-items: center;
            margin-right: 1.5rem;
            cursor: pointer;
            font-weight: 500;
            color: #475569;
        }

        .platform-selector input[type="checkbox"] {
            margin-right: 0.5rem;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        /* Date Time Picker */
        .datetime-group {
            margin-bottom: 1.5rem;
        }

        .datetime-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #1e293b;
        }

        .datetime-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .datetime-inputs input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.2s ease;
        }

        .datetime-inputs input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* Schedule Options */
        .schedule-options {
            display: grid;
            gap: 1rem;
            margin-top: 2rem;
        }

        .schedule-options button {
            padding: 1rem;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .schedule-options .btn-post-now {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .schedule-options .btn-schedule {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .schedule-options .btn-draft {
            background: #f1f5f9;
            color: #64748b;
        }

        .schedule-options button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .schedule-options button:active {
            transform: translateY(0);
        }

        /* Success Message */
        .success-message {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            display: none;
        }

        .success-message.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

    </style>
</head>
<body>
    <a href="social_media_calendar.html" class="nav-link">üìÖ View Calendar</a>

    <a href="social_media_calendar.html" class="nav-link">üìÖ View Calendar</a>

    <div class="studio-container">
        <!-- LEFT PANEL - Carousel Editor -->
        <div class="carousel-panel">
            <div class="panel-header">
                <h2>Photo Carousel</h2>
                <p>Reorder photos with keyboard arrows or drag</p>
            </div>

            <!-- Photo Preview (navigation on Live Preview ‚Üí) -->
            <div class="carousel-container">
                <div class="carousel-main">
                    <div class="carousel-track" id="carouselTrack">
                        <!-- Slides will be inserted here -->
                    </div>
                    <div class="carousel-dots" id="carouselDots">
                        <!-- Dots will be inserted here -->
                    </div>
                </div>
            </div>

            <!-- Photo Grid Manager -->
            <div class="photo-manager">
                <div class="photo-manager-title">Photo Order (Drag to Reorder)</div>
                <div class="photo-grid" id="photoGrid">
                    <!-- Photos will be inserted here -->
                </div>
            </div>

            <!-- Platform Selector -->
            <div>
                <div class="photo-manager-title">Platform</div>
                <div class="platform-selector">
                    <button class="platform-btn active facebook" data-platform="facebook"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor" style="vertical-align: middle; margin-right: 6px;">
                        <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                    </svg>Facebook</button>
                    <button class="platform-btn instagram" data-platform="instagram"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor" style="vertical-align: middle; margin-right: 6px;">
                        <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                    </svg>Instagram</button>
                    <button class="platform-btn linkedin" data-platform="linkedin"><svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor" style="vertical-align: middle; margin-right: 6px;">
                        <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                    </svg>LinkedIn</button>
                </div>
            </div>

            <div class="helper-text">
                üí° Use ‚Üê ‚Üí arrow keys to navigate photos when selected
            </div>
        </div>

        <!-- RIGHT PANEL - Preview & Editor -->
        <div class="editor-panel">
            <!-- Live Preview -->
            <div class="preview-section">
                <div class="preview-header">
                    <h3>Live Preview</h3>
                    <div class="preview-device-info" id="deviceInfo">1200 √ó 630</div>
                </div>

                <div class="preview-mockup">
                    <div class="mockup-header">
                        <div class="mockup-avatar"></div>
                        <div class="mockup-info">
                            <h4 id="mockupAgencyName">Your Estate Agency</h4>
                            <p>Just now</p>
                        </div>
                    </div>
                    <div class="mockup-carousel-container facebook" id="mockupCarousel">
                        <img class="mockup-carousel-image" id="mockupImage" src="" alt="Preview">
                        <button class="carousel-nav prev" onclick="prevSlide()">‚Äπ</button>
                        <button class="carousel-nav next" onclick="nextSlide()">‚Ä∫</button>
                        <div class="mockup-carousel-dots" id="mockupDots">
                            <!-- Dots mirror carousel -->
                        </div>
                    </div>
                    <div class="mockup-content">
                        <div class="mockup-text" id="mockupText">Your post content will appear here...</div>
                        <div class="mockup-hashtags" id="mockupHashtags">
                            <!-- Hashtags will appear here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Text Editor -->
            <div class="editor-section">
                <div class="editor-header">
                    <h3>Post Content</h3>
                    <div class="variant-tabs">
                        <button class="variant-tab active" data-variant="0">Standard</button>
                        <button class="variant-tab" data-variant="1">Bullets</button>
                        <button class="variant-tab" data-variant="2">Concise</button>
                    </div>
                </div>

                <div class="editor-tools">
                    <button class="tool-btn" id="boldBtn" title="Bold (Ctrl+B)" onclick="formatText('bold')"><b>B</b></button>
                    <button class="tool-btn" id="italicBtn" title="Italic (Ctrl+I)" onclick="formatText('italic')"><i>I</i></button>
                    <button class="tool-btn" id="emojiBtn" title="Insert emoji">üòä</button>
                </div>

                <div style="position: relative;">
                    <div contenteditable="true" class="text-editor" id="textEditor" placeholder="Start typing...">
Loading your generated post...
                    </div>
                    <div class="emoji-picker" id="emojiPicker">
                        <div class="emoji-grid" id="emojiGrid">
                            <!-- Emojis will be inserted here -->
                        </div>
                    </div>
                </div>

                <div class="char-info">
                    <span class="char-count" id="charCount">0 / 300</span>
                    <span id="platformLimit">Facebook recommended</span>
                </div>

                <!-- Hashtags Section -->
                <div class="hashtags-section">
                    <div class="hashtags-header">
                        <h4>Hashtags</h4>
                        <div class="hashtag-score">
                            <span class="score-badge" id="scoreText">0</span>
                            <div class="score-bar-container">
                                <div class="score-bar" id="scoreBar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    <div class="hashtags-list" id="hashtagsList">
                        <!-- Hashtags will be inserted here -->
                    </div>
                    <button class="optimize-btn" onclick="optimizeHashtags()">‚ö° Optimize Hashtags</button>
                </div>

                <!-- Key Features Section -->
                <div class="features-section">
                    <div class="section-header">
                        <h4>‚ú® Key Features</h4>
                        <label class="toggle-switch">
                            <input type="checkbox" id="featuresToggle" checked onchange="toggleFeatures()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="features-list" id="featuresList">
                        <!-- Features will be inserted here -->
                    </div>
                </div>

                <!-- Agent Contact Section -->
                <div class="contact-section">
                    <div class="section-header">
                        <h4>üìû Agent Contact</h4>
                        <label class="toggle-switch">
                            <input type="checkbox" id="contactToggle" checked onchange="toggleContact()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="contact-info" id="contactInfo">
                        <input type="text" id="agentName" placeholder="Agent Name" class="contact-input">
                        <input type="tel" id="agentPhone" placeholder="Phone Number" class="contact-input">
                        <input type="email" id="agentEmail" placeholder="Email Address" class="contact-input">
                    </div>
                </div>

                <!-- Actions -->
                <div class="actions">
                    <button class="action-btn schedule" onclick="openScheduleModal()">üìÖ Schedule Post</button>
                    <button class="action-btn secondary" onclick="window.close()">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scheduling Modal -->
    <div id="scheduleModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Schedule Post</h3>
                <button class="close-btn" onclick="closeScheduleModal()">&times;</button>
            </div>

            <div id="successMessage" class="success-message"></div>

            <div class="modal-body">
                <div class="platform-selector">
                    <label>
                        <input type="checkbox" id="platformFacebook" value="facebook" checked>
                        Facebook
                    </label>
                    <label>
                        <input type="checkbox" id="platformInstagram" value="instagram" checked>
                        Instagram
                    </label>
                </div>

                <div class="datetime-group">
                    <label>When do you want to post?</label>
                    <div class="datetime-inputs">
                        <input type="date" id="scheduleDate" required>
                        <input type="time" id="scheduleTime" required>
                    </div>
                </div>

                <div class="schedule-options">
                    <button class="btn-post-now" onclick="schedulePost('now')">
                        Post Now (Coming Soon)
                    </button>
                    <button class="btn-schedule" onclick="schedulePost('later')">
                        Schedule for Later
                    </button>
                    <button class="btn-draft" onclick="saveAsDraft()">
                        Save as Draft
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scheduling Modal -->
    <div id="scheduleModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Schedule Post</h3>
                <button class="close-btn" onclick="closeScheduleModal()">&times;</button>
            </div>

            <div id="successMessage" class="success-message"></div>

            <div class="modal-body">
                <div class="platform-selector">
                    <label>
                        <input type="checkbox" id="platformFacebook" value="facebook" checked>
                        Facebook
                    </label>
                    <label>
                        <input type="checkbox" id="platformInstagram" value="instagram" checked>
                        Instagram
                    </label>
                </div>

                <div class="datetime-group">
                    <label>When do you want to post?</label>
                    <div class="datetime-inputs">
                        <input type="date" id="scheduleDate" required>
                        <input type="time" id="scheduleTime" required>
                    </div>
                </div>

                <div class="schedule-options">
                    <button class="btn-post-now" onclick="schedulePost('now')">
                        Post Now (Coming Soon)
                    </button>
                    <button class="btn-schedule" onclick="schedulePost('later')">
                        Schedule for Later
                    </button>
                    <button class="btn-draft" onclick="saveAsDraft()">
                        Save as Draft
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast">Action completed!</div>

    <script>
        // Global state
        let currentData = null;
        let currentSlide = 0;
        let currentPlatform = 'facebook';
        let currentVariant = 0;
        let selectedPhotoIndex = -1;

        // Initialize
        window.addEventListener('DOMContentLoaded', () => {
            currentData = window.opener?.socialMediaData;

            if (!currentData) {
                document.getElementById('textEditor').textContent = 'Error: No data received. Please try again.';
                return;
            }

            console.log('Loaded data:', currentData);

            loadCarousel();
            loadPhotoGrid();
            loadText();
            loadHashtags();
            loadFeatures();
            setupEventListeners();
            setupEmojiPicker();
            updatePreview();
        });

        // Carousel Functions
        function loadCarousel() {
            const photos = currentData.photos || [];
            if (photos.length === 0) return;

            const track = document.getElementById('carouselTrack');
            const dots = document.getElementById('carouselDots');

            track.innerHTML = photos.map((photo, i) => `
                <div class="carousel-slide">
                    ${i === 0 ? '<div class="photo-cover-badge">COVER</div>' : ''}
                    <img src="${photo.dataUrl}" alt="${photo.name}">
                </div>
            `).join('');

            dots.innerHTML = photos.map((_, i) => `
                <div class="carousel-dot ${i === 0 ? 'active' : ''}" onclick="goToSlide(${i})"></div>
            `).join('');

            updateCarouselPosition();
        }

        function loadPhotoGrid() {
            const photos = currentData.photos || [];
            const grid = document.getElementById('photoGrid');

            const photoItems = photos.map((photo, i) => `
                <div class="photo-item ${i === 0 ? 'selected' : ''}"
                     draggable="true"
                     data-index="${i}"
                     onclick="selectPhotoItem(${i})">
                    <img src="${photo.dataUrl}" alt="${photo.name}">
                    <div class="photo-item-number">${i + 1}</div>
                    ${photos.length > 1 ? `<div class="photo-item-remove" onclick="event.stopPropagation(); removePhoto(${i})">√ó</div>` : ''}
                </div>
            `).join('');

            const addBtn = '<div class="add-photo-btn" onclick="addPhotoFromFile()">+</div>';
            grid.innerHTML = photoItems + addBtn;

            setupDragAndDrop();
        }

        function setupDragAndDrop() {
            const items = document.querySelectorAll('.photo-item');
            let draggedItem = null;

            items.forEach(item => {
                item.addEventListener('dragstart', (e) => {
                    draggedItem = item;
                    item.style.opacity = '0.5';
                });

                item.addEventListener('dragend', () => {
                    item.style.opacity = '1';
                });

                item.addEventListener('dragover', (e) => {
                    e.preventDefault();
                });

                item.addEventListener('drop', (e) => {
                    e.preventDefault();
                    if (draggedItem !== item) {
                        const fromIndex = parseInt(draggedItem.dataset.index);
                        const toIndex = parseInt(item.dataset.index);
                        reorderPhotos(fromIndex, toIndex);
                    }
                });
            });
        }

        function reorderPhotos(fromIndex, toIndex) {
            const photos = currentData.photos;
            const [movedPhoto] = photos.splice(fromIndex, 1);
            photos.splice(toIndex, 0, movedPhoto);

            currentSlide = toIndex;
            loadCarousel();
            loadPhotoGrid();
            updatePreview();
            showToast('Photos reordered');
        }

        function selectPhotoItem(index) {
            selectedPhotoIndex = index;
            currentSlide = index;
            updateCarouselPosition();

            document.querySelectorAll('.photo-item').forEach((item, i) => {
                item.classList.toggle('selected', i === index);
            });
        }

        function prevSlide() {
            const photos = currentData.photos || [];
            currentSlide = (currentSlide - 1 + photos.length) % photos.length;
            updateCarouselPosition();
        }

        function nextSlide() {
            const photos = currentData.photos || [];
            currentSlide = (currentSlide + 1) % photos.length;
            updateCarouselPosition();
        }

        function goToSlide(index) {
            currentSlide = index;
            updateCarouselPosition();
        }

        function updateCarouselPosition() {
            const track = document.getElementById('carouselTrack');
            const dots = document.querySelectorAll('.carousel-dot');

            track.style.transform = `translateX(-${currentSlide * 100}%)`;

            dots.forEach((dot, i) => {
                dot.classList.toggle('active', i === currentSlide);
            });

            selectedPhotoIndex = currentSlide;
            document.querySelectorAll('.photo-item').forEach((item, i) => {
                item.classList.toggle('selected', i === currentSlide);
            });

            updatePreview();
        }

        function removePhoto(index) {
            if (currentData.photos.length <= 1) {
                showToast('Cannot remove last photo', 'error');
                return;
            }

            currentData.photos.splice(index, 1);
            if (currentSlide >= currentData.photos.length) {
                currentSlide = currentData.photos.length - 1;
            }

            loadCarousel();
            loadPhotoGrid();
            updatePreview();
            showToast('Photo removed');
        }

        function addPhotoFromFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';

            input.onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => {
                    currentData.photos = currentData.photos || [];
                    currentData.photos.push({
                        id: 'photo_' + Date.now(),
                        dataUrl: event.target.result,
                        name: file.name,
                        category: 'additional'
                    });

                    loadCarousel();
                    loadPhotoGrid();
                    currentSlide = currentData.photos.length - 1;
                    updateCarouselPosition();
                    showToast('Photo added');
                };
                reader.readAsDataURL(file);
            };

            input.click();
        }

        // Text & Content Functions
        function loadText() {
            console.log('Loading text from data:', currentData);

            // Try multiple field names
            let postText = currentData.post_text || currentData.text || currentData.content;

            if (!postText && currentData.post_text === '') {
                postText = 'No content was generated. Please try again.';
            }

            if (!postText) {
                postText = 'Generating your post...';
                console.warn('No text found in data:', Object.keys(currentData));
            }

            console.log('Final text to display:', postText);

            document.getElementById('textEditor').textContent = postText;

            // Store variants for future use
            if (!currentData.variants) {
                // Generate 3 variants from the base text
                currentData.variants = generateTextVariants(postText);
            }

            updateCharCount();
        }

        // Generate 3 variants with different styles
        function generateTextVariants(baseText) {
            if (!baseText || baseText.includes('No content')) {
                return [baseText, baseText, baseText];
            }

            // Variant 0: Standard format (original paragraph text)
            const standardText = baseText;

            // Variant 1: Bullet point format
            const bulletText = convertToBullets(baseText);

            // Variant 2: Concise format (shortened, punchy)
            const conciseText = makeConcise(baseText);

            return [standardText, bulletText, conciseText];
        }

        function convertToBullets(text) {
            // Convert sentences to bullet points
            const sentences = text.split(/[.!]\s+/).filter(s => s.trim().length > 15);

            if (sentences.length === 0) return text;

            // Take up to 6 key sentences
            const bullets = sentences.slice(0, 6).map(sentence => {
                const cleaned = sentence.trim()
                    .replace(/^(This|The property|The|A|An|It|We)\s+/i, '')
                    .trim();
                const capitalized = cleaned.charAt(0).toUpperCase() + cleaned.slice(1);
                return '\u2022 ' + capitalized;
            }).join('\n');

            return bullets || text;
        }

        function makeConcise(text) {
            // Create a shorter, punchier version
            const sentences = text.split(/[.!]\s+/).filter(s => s.trim().length > 10);

            if (sentences.length === 0) return text;

            // Take first 3 sentences only
            const concise = sentences.slice(0, 3).join('. ').trim() + '.';

            return concise || text;
        }

        function loadHashtags() {
            const hashtags = currentData.hashtags || [];
            const container = document.getElementById('hashtagsList');

            if (hashtags.length === 0) {
                container.innerHTML = '<div class="hashtag">#PropertyListing</div>';
                calculateHashtagScore();
                return;
            }

            container.innerHTML = hashtags.map((tag, index) => {
                const cleanTag = tag.startsWith('#') ? tag : '#' + tag;
                const score = calculateSingleHashtagScore(cleanTag);
                const scoreClass = score >= 70 ? 'high' : score >= 40 ? 'medium' : 'low';

                // Determine competition level for color coding
                let competitionClass = '';
                if (score >= 75) {
                    competitionClass = 'low-competition';
                } else if (score >= 50) {
                    competitionClass = 'medium-competition';
                } else {
                    competitionClass = 'high-competition';
                }

                return `<div class="hashtag ${competitionClass}" data-index="${index}">
                    ${cleanTag}
                    <span class="hashtag-score-badge ${scoreClass}">${score}</span>
                    <span class="hashtag-remove" onclick="removeHashtag(${index})">√ó</span>
                </div>`;
            }).join('');

            calculateHashtagScore();
        }

        function updateCharCount() {
            const text = document.getElementById('textEditor').textContent;
            const count = text.length;
            const limit = getPlatformLimit();

            const charCountEl = document.getElementById('charCount');
            charCountEl.textContent = `${count} / ${limit}`;

            charCountEl.classList.remove('warning', 'error');
            if (count > limit) {
                charCountEl.classList.add('error');
            } else if (count > limit * 0.9) {
                charCountEl.classList.add('warning');
            }

            updatePreview();
        }

        function getPlatformLimit() {
            const limits = { facebook: 300, instagram: 2200, linkedin: 3000 };
            return limits[currentPlatform] || 300;
        }

        function updatePreview() {
            // Update text
            const text = document.getElementById('textEditor').textContent;
            document.getElementById('mockupText').textContent = text;

            // Update image
            const photos = currentData.photos || [];
            if (photos.length > 0 && photos[currentSlide]) {
                document.getElementById('mockupImage').src = photos[currentSlide].dataUrl;
            }

            // Update hashtags
            const hashtags = Array.from(document.querySelectorAll('.hashtag'))
                .map(el => el.textContent.split(/\d+/)[0].trim());

            const mockupHashtags = document.getElementById('mockupHashtags');
            mockupHashtags.innerHTML = hashtags.map(tag =>
                `<span class="mockup-hashtag">${tag}</span>`
            ).join(' ');

            // Update carousel dots in mockup
            const mockupDots = document.getElementById('mockupDots');
            mockupDots.innerHTML = photos.map((_, i) =>
                `<div class="dot ${i === currentSlide ? 'active' : ''}"></div>`
            ).join('');

            // Update platform-specific dimensions
            updatePlatformDisplay();
        }

        function updatePlatformDisplay() {
            const specs = {
                facebook: { dimensions: '1200 √ó 630', aspect: 'facebook' },
                instagram: { dimensions: '1080 √ó 1080', aspect: 'instagram' },
                linkedin: { dimensions: '1200 √ó 627', aspect: 'linkedin' }
            };

            const spec = specs[currentPlatform];
            document.getElementById('deviceInfo').textContent = spec.dimensions;

            const mockupCarousel = document.getElementById('mockupCarousel');
            mockupCarousel.className = `mockup-carousel-container ${spec.aspect}`;
        }

        // Event Listeners
        function setupEventListeners() {
            // Platform selector
            document.querySelectorAll('.platform-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.platform-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentPlatform = btn.dataset.platform;
                    updateCharCount();
                    updatePreview();

                    const platformNames = { facebook: 'Facebook', instagram: 'Instagram', linkedin: 'LinkedIn' };
                    document.getElementById('platformLimit').textContent = `${platformNames[currentPlatform]} recommended`;
                });
            });

            // Variant tabs
            document.querySelectorAll('.variant-tab').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.variant-tab').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentVariant = parseInt(btn.dataset.variant);

                    // Load the selected variant
                    if (currentData.variants && currentData.variants[currentVariant]) {
                        document.getElementById('textEditor').textContent = currentData.variants[currentVariant];
                        updateCharCount();
                        updatePreview();
                    }
                });
            });

            // Text editor
            document.getElementById('textEditor').addEventListener('input', updateCharCount);

            // Keyboard navigation
            document.addEventListener('keydown', (e) => {
                if (selectedPhotoIndex === -1) return;

                if (e.key === 'ArrowLeft') {
                    e.preventDefault();
                    prevSlide();
                } else if (e.key === 'ArrowRight') {
                    e.preventDefault();
                    nextSlide();
                }
            });
        }

        // Emoji Picker
        function setupEmojiPicker() {
            const emojis = [
                'üòä', 'üè°', 'üè†', 'üèòÔ∏è', 'üè¢', 'üèôÔ∏è', '‚ú®', '‚≠ê', 'üíé', 'üîë',
                'üö™', 'ü™ü', 'üõèÔ∏è', 'üõãÔ∏è', 'üçΩÔ∏è', 'üõÅ', 'üöø', 'üå≥', 'üå∏', 'üå∫',
                '‚òÄÔ∏è', 'üå§Ô∏è', 'üèñÔ∏è', 'üèä', 'üé®', 'üì∏', '‚ù§Ô∏è', 'üíØ', 'üëç', 'üôå',
                'üéâ', 'üéä', 'üí´', '‚úÖ', 'üìç', 'üó∫Ô∏è', 'üöó', 'üöá', 'üöå', 'üèÉ',
                'üë®‚Äçüë©‚Äçüëß‚Äçüë¶', 'üë∂', 'üß∏', 'üìö', 'üéì', 'üíº', 'üîí', 'üåü', 'üèÜ', 'üí∞'
            ];

            const grid = document.getElementById('emojiGrid');
            grid.innerHTML = emojis.map(emoji =>
                `<div class="emoji-item" onclick="insertEmoji('${emoji}')">${emoji}</div>`
            ).join('');

            document.getElementById('emojiBtn').addEventListener('click', (e) => {
                e.stopPropagation();
                const picker = document.getElementById('emojiPicker');
                picker.classList.toggle('show');
            });

            document.addEventListener('click', (e) => {
                const picker = document.getElementById('emojiPicker');
                const btn = document.getElementById('emojiBtn');
                if (!picker.contains(e.target) && e.target !== btn) {
                    picker.classList.remove('show');
                }
            });
        }

        function insertEmoji(emoji) {
            const editor = document.getElementById('textEditor');
            const selection = window.getSelection();

            if (selection.rangeCount > 0) {
                const range = selection.getRangeAt(0);
                range.deleteContents();
                range.insertNode(document.createTextNode(emoji));
                range.collapse(false);
            } else {
                editor.textContent += emoji;
            }

            updateCharCount();
            document.getElementById('emojiPicker').classList.remove('show');
        }

        // Hashtag Optimization
        function calculateSingleHashtagScore(tag) {
            const cleanTag = tag.replace('#', '').toLowerCase();
            let score = 50;

            const length = cleanTag.length;
            if (length >= 10 && length <= 20) {
                score += 20;
            } else if (length >= 5 && length < 30) {
                score += 10;
            } else {
                score -= 10;
            }

            const highValueKeywords = ['luxury', 'property', 'realestate', 'home', 'house', 'estate', 'listing'];
            const mediumValueKeywords = ['sale', 'buy', 'rent', 'investment', 'bedroom', 'location'];

            if (highValueKeywords.some(kw => cleanTag.includes(kw))) {
                score += 25;
            } else if (mediumValueKeywords.some(kw => cleanTag.includes(kw))) {
                score += 15;
            }

            if (length < 15 && !cleanTag.includes('_') && !cleanTag.includes('-')) {
                score += 10;
            }

            return Math.min(100, Math.max(0, score));
        }

        function calculateHashtagScore() {
            const hashtags = Array.from(document.querySelectorAll('.hashtag'));
            if (hashtags.length === 0) {
                updateScoreDisplay(0);
                return;
            }

            let totalScore = 0;
            hashtags.forEach(el => {
                const scoreEl = el.querySelector('.hashtag-score-badge');
                if (scoreEl) {
                    totalScore += parseInt(scoreEl.textContent) || 0;
                }
            });

            const avgScore = Math.round(totalScore / hashtags.length);
            updateScoreDisplay(avgScore);
        }

        function updateScoreDisplay(score) {
            document.getElementById('scoreText').textContent = score;
            document.getElementById('scoreBar').style.width = `${score}%`;
        }


        function removeHashtag(index) {
            if (currentData.hashtags.length <= 1) {
                showToast('Need at least one hashtag', 'error');
                return;
            }

            currentData.hashtags.splice(index, 1);
            loadHashtags();
            updatePreview();
            showToast('Hashtag removed');
        }

        function removeHashtag(index) {
            if (currentData.hashtags.length <= 1) {
                showToast('Need at least one hashtag', 'error');
                return;
            }

            currentData.hashtags.splice(index, 1);
            loadHashtags();
            updatePreview();
            showToast('Hashtag removed');
        }
        function optimizeHashtags() {
            const formData = currentData.formData || {};
            const propertyType = formData.property_type || 'Property';
            const bedrooms = formData.bedrooms || '';
            const address = formData.address || '';

            const locationParts = address.split(',');
            const city = locationParts[locationParts.length - 2]?.trim().replace(/\s+/g, '') || 'Location';

            const optimized = [
                `#${propertyType.replace(/\s+/g, '')}ForSale`,
                `#${city}Property`,
                '#LuxuryHomes',
                bedrooms ? `#${bedrooms}Bedroom` : '#ModernHome',
                `#${city}RealEstate`,
                '#PropertyInvestment'
            ];

            currentData.hashtags = optimized;
            loadHashtags();
            updatePreview();
            showToast('Hashtags optimized!');
        }

        // Features Management
        function loadFeatures() {
            const formData = currentData.formData || {};
            const features = [];

            // Add key property features
            if (formData.bedrooms) features.push(`${formData.bedrooms} Bedrooms`);
            if (formData.bathrooms) features.push(`${formData.bathrooms} Bathrooms`);
            if (formData.property_type) features.push(formData.property_type);
            if (formData.price) features.push(`Price: ${formData.price}`);

            const featuresList = document.getElementById('featuresList');
            featuresList.innerHTML = '';

            if (features.length === 0) {
                featuresList.innerHTML = '<div class="feature-item">Modern Property</div>';
            } else {
                features.forEach(feature => {
                    const featureEl = document.createElement('div');
                    featureEl.className = 'feature-item';
                    featureEl.textContent = feature;
                    featuresList.appendChild(featureEl);
                });
            }

            // Load agent contact info
            if (formData.agent_name) {
                document.getElementById('agentName').value = formData.agent_name;
            }
            if (formData.agent_phone) {
                document.getElementById('agentPhone').value = formData.agent_phone;
            }
            if (formData.agent_email) {
                document.getElementById('agentEmail').value = formData.agent_email;
            }
        }

        function toggleFeatures() {
            const toggle = document.getElementById('featuresToggle');
            const featuresList = document.getElementById('featuresList');

            if (toggle.checked) {
                featuresList.style.display = 'flex';
            } else {
                featuresList.style.display = 'none';
            }
        }

        function toggleContact() {
            const toggle = document.getElementById('contactToggle');
            const contactInfo = document.getElementById('contactInfo');

            if (toggle.checked) {
                contactInfo.style.display = 'flex';
            } else {
                contactInfo.style.display = 'none';
            }
        }

        // Utility Functions
        function saveDraft() {
            const draft = {
                text: document.getElementById('textEditor').textContent,
                hashtags: currentData.hashtags,
                platform: currentPlatform,
                variant: currentVariant,
                timestamp: new Date().toISOString()
            };

            localStorage.setItem('socialMediaDraft', JSON.stringify(draft));
            showToast('Draft saved successfully!');
        }

        function loadDraft() {
            const saved = localStorage.getItem('socialMediaDraft');
            if (saved) {
                try {
                    const draft = JSON.parse(saved);
                    const age = Date.now() - new Date(draft.timestamp).getTime();

                    // Only load drafts less than 24 hours old
                    if (age < 24 * 60 * 60 * 1000) {
                        document.getElementById('textEditor').textContent = draft.text;
                        currentData.hashtags = draft.hashtags;
                        currentPlatform = draft.platform;
                        currentVariant = draft.variant;
                        loadHashtags();
                        updateCharCount();
                        updatePreview();
                        showToast('Draft loaded');
                    }
                } catch (e) {
                    console.error('Failed to load draft:', e);
                }
            }
        }

        // Text formatting function for Bold/Italic
        function formatText(command) {
            try {
                const editor = document.getElementById('textEditor');
                editor.focus();

                // Use execCommand for bold/italic
                document.execCommand(command, false, null);

                // Trigger preview update
                updatePreview();
            } catch (error) {
                console.error('Format error:', error);
                showToast('Formatting not supported', 'error');
            }
        }

        function copyContent() {
            const text = document.getElementById('textEditor').textContent;
            const hashtags = Array.from(document.querySelectorAll('.hashtag'))
                .map(el => el.textContent.split(/\d+/)[0].trim())
                .join(' ');

            let fullContent = text;

            // Add features if enabled
            const featuresToggle = document.getElementById('featuresToggle');
            if (featuresToggle.checked) {
                const features = Array.from(document.querySelectorAll('.feature-item'))
                    .map(el => `‚Ä¢ ${el.textContent}`)
                    .join('\n');
                if (features) {
                    fullContent += `\n\n‚ú® Key Features:\n${features}`;
                }
            }

            // Add contact info if enabled
            const contactToggle = document.getElementById('contactToggle');
            if (contactToggle.checked) {
                const name = document.getElementById('agentName').value;
                const phone = document.getElementById('agentPhone').value;
                const email = document.getElementById('agentEmail').value;

                if (name || phone || email) {
                    fullContent += '\n\nüìû Contact:';
                    if (name) fullContent += `\n${name}`;
                    if (phone) fullContent += `\n${phone}`;
                    if (email) fullContent += `\n${email}`;
                }
            }

            fullContent += `\n\n${hashtags}`;

            navigator.clipboard.writeText(fullContent).then(() => {
                showToast('Copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy:', err);
                showToast('Failed to copy', 'error');
            });
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.style.background = type === 'error' ? '#ef4444' : '#1e293b';
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2000);
        }
    
        // ==========================================
        // SCHEDULING FUNCTIONS
        // ==========================================

        function openScheduleModal() {
            const modal = document.getElementById('scheduleModal');
            modal.classList.add('active');

            // Set default date/time to tomorrow at 10am
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(10, 0, 0, 0);

            const dateStr = tomorrow.toISOString().split('T')[0];
            const timeStr = '10:00';

            document.getElementById('scheduleDate').value = dateStr;
            document.getElementById('scheduleTime').value = timeStr;
        }

        function closeScheduleModal() {
            const modal = document.getElementById('scheduleModal');
            modal.classList.remove('active');
            document.getElementById('successMessage').classList.remove('active');
        }

        function collectPostData() {
            // Get all current post data
            const caption = document.getElementById('textEditor').textContent;
            const hashtags = Array.from(document.querySelectorAll('.hashtag'))
                .map(el => el.textContent.split(/\d+/)[0].trim());

            // Get current images
            const images = [];
            if (currentData && currentData.images) {
                images.push(...currentData.images);
            }

            // Get agent contact if enabled
            let agentContact = null;
            const contactToggle = document.getElementById('contactToggle');
            if (contactToggle && contactToggle.checked) {
                agentContact = {
                    name: document.getElementById('agentName')?.value || '',
                    phone: document.getElementById('agentPhone')?.value || '',
                    email: document.getElementById('agentEmail')?.value || ''
                };
            }

            // Get selected platforms
            const platforms = [];
            if (document.getElementById('platformFacebook').checked) platforms.push('facebook');
            if (document.getElementById('platformInstagram').checked) platforms.push('instagram');

            return {
                caption,
                hashtags,
                images,
                agentContact,
                platforms,
                propertyId: currentData?.session_id || null
            };
        }

        function schedulePost(timing) {
            const postData = collectPostData();

            // Validate platforms selected
            if (postData.platforms.length === 0) {
                showToast('Please select at least one platform', 'error');
                return;
            }

            // Validate caption
            if (!postData.caption || postData.caption.trim() === '' || postData.caption.includes('No content')) {
                showToast('Please add some text to your post first', 'error');
                return;
            }

            let scheduledTime;
            let status;

            if (timing === 'now') {
                scheduledTime = new Date();
                status = 'publishing';
                showToast('Post Now feature coming soon! Use Schedule for Later instead.', 'info');
                return;
            } else {
                // Get date and time from inputs
                const dateValue = document.getElementById('scheduleDate').value;
                const timeValue = document.getElementById('scheduleTime').value;

                if (!dateValue || !timeValue) {
                    showToast('Please select a date and time', 'error');
                    return;
                }

                scheduledTime = new Date(dateValue + 'T' + timeValue);
                status = 'scheduled';

                // Validate not in the past
                if (scheduledTime < new Date()) {
                    showToast('Cannot schedule posts in the past', 'error');
                    return;
                }
            }

            // Save to localStorage
            saveToSchedule(postData, scheduledTime, status);

            // Show success message in modal
            const successMsg = document.getElementById('successMessage');
            successMsg.textContent = `‚úì Post scheduled for ${scheduledTime.toLocaleString()}!`;
            successMsg.classList.add('active');

            // Auto-close modal and redirect to calendar
            setTimeout(() => {
                closeScheduleModal();
                window.location.href = 'social_media_calendar.html';
            }, 1500);
        }

        function saveAsDraft() {
            const postData = collectPostData();

            // Validate caption
            if (!postData.caption || postData.caption.trim() === '' || postData.caption.includes('No content')) {
                showToast('Please add some text to your post first', 'error');
                return;
            }

            // Save as draft (no scheduled time)
            saveToSchedule(postData, null, 'draft');

            // Show success
            const successMsg = document.getElementById('successMessage');
            successMsg.textContent = '‚úì Post saved as draft!';
            successMsg.classList.add('active');

            setTimeout(() => {
                closeScheduleModal();
                window.location.href = 'social_media_calendar.html';
            }, 1500);
        }

        function saveToSchedule(postData, scheduledTime, status) {
            // Get existing posts from localStorage
            let scheduledPosts = JSON.parse(localStorage.getItem('scheduledPosts') || '[]');

            // Create new post object
            const newPost = {
                id: 'post_' + Date.now(),
                ...postData,
                scheduledTime: scheduledTime ? scheduledTime.toISOString() : null,
                status: status,
                createdAt: new Date().toISOString(),
                publishedAt: null
            };

            // Add to array
            scheduledPosts.push(newPost);

            // Save back to localStorage
            localStorage.setItem('scheduledPosts', JSON.stringify(scheduledPosts));

            console.log('‚úì Post saved to schedule:', newPost);
            showToast(`Post ${status === 'draft' ? 'saved as draft' : 'scheduled'}!`);
        }

        // Close modal when clicking outside
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('scheduleModal');
            if (event.target === modal) {
                closeScheduleModal();
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const modal = document.getElementById('scheduleModal');
                if (modal && modal.classList.contains('active')) {
                    closeScheduleModal();
                }
            }
        });

    </script>
</body>
</html>
